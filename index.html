<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<style type="text/css">
			html, body{
				margin: 0;
				padding: 0;
				display: grid;
				grid-template-columns: 1fr;
  				grid-template-rows: 100vh;
				align-items: center;
  				justify-items: center;
				background-color: black;
			}
			canvas {
				display: block;
				width: 128px;
				height: 128px;
				margin-left: auto;
				margin-right: auto;
				border: none;
				background-color: white;
			}
		</style>
	</head>
	<body>
<div id="day-3"></div>
<script src="./settween.js"></script>
<script src="./adventcanvas.js"></script>
<script>
	// var coin = {x: 64, y: 64}
	// var coinTarget = {x: 64, y: 64}
	// var movingId = 0

	var pen = {x: 64, y: 64}
	var segmentsDrawn = []
	var pointsDrawn = []

	var {canvas, context} = adventCanvas("day-3", draw, {
		click: onClick,
		mousedown: onMouseDown,
		mousemove: onMouseMove,
		mouseup: onMouseUp,
		mouseenter: onMouseEnter,
		mouseleave: onMouseLeave,
		contextmenu: onContextMenu,
		touchmove: onTouchMove,
	})

	function draw(ctx) {
		update()

		ctx.fillStyle = "#0D8CFD"
		ctx.beginPath()
		ctx.arc(pen.x, pen.y, 4, 0, 2 * Math.PI)
		ctx.fill()

		ctx.strokeStyle = "#0D8CFD"
		ctx.lineWidth = 4
		ctx.lineCap = "round"
		segmentsDrawn.forEach(segment => {
			for(let i = 0; i < segment.length - 1; i++) {
			let point = segment[i]
			let nextPoint = segment[i+1]

			ctx.beginPath()
			ctx.moveTo(point.x, point.y)
			ctx.lineTo(nextPoint.x, nextPoint.y)
			ctx.stroke()

		}
		})
	}

	function update() {			
	}

	function powerEasing(a, b, x) {
		return (b+a-2)* Math.pow(x,3) + (-2*a-b+3)* Math.pow(x,2) + a*x
	}

	function onClick(event) {
	}

	let isDrawing = false

	function onMouseDown(event) {
		event.preventDefault()
		event.stopPropagation()
		if(event.buttons == 1) {
			isDrawing = true;
			segmentsDrawn.push([])
		}
	}

	function onContextMenu(event){
		event.preventDefault()
		pointsDrawn = []
		segmentsDrawn = []
	}

	function onMouseMove(event) {
		pen.x = event.offsetX
		pen.y = event.offsetY
		if(isDrawing) {
			segmentsDrawn[segmentsDrawn.length - 1].push({x: pen.x, y: pen.y})
		}
	}

	function onMouseUp(event) {
		isDrawing = false;
	}

	function onMouseEnter(event) {
		canvas.style.cursor = "none"
	}

	function onMouseLeave(event) {
		canvas.style.cursor = "default"
	}

	function onTouchStart(event) {
		segmentsDrawn.push([])
	}

	function onTouchMove(event){
		let rect = event.target.getBoundingClientRect()
		pen.x = event.targetTouches[0].clientX - rect.left
		pen.y = event.targetTouches[0].clientY - rect.top
		segmentsDrawn[segmentsDrawn.length - 1].push({x: pen.x, y: pen.y})
	}
</script>
</body>
</html>