<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<style type="text/css">
			html, body{
				margin: 0;
				padding: 0;
				display: grid;
				grid-template-columns: 1fr;
  				grid-template-rows: 100vh;
				align-items: center;
  				justify-items: center;
				background-color: black;
			}
			canvas {
				display: block;
				width: 128px;
				height: 128px;
				margin-left: auto;
				margin-right: auto;
				border: none;
				background-color: white;
			}
		</style>
	</head>
	<body>
<div id="day-3"></div>
<script>
	var canvas, context
	var pixelRato = 1
	document.addEventListener("DOMContentLoaded", () => {
		let canvasContainer = document.getElementById("day-3")
		canvas = document.createElement("canvas")
		canvas.width = 128
		canvas.height = 128
		canvasContainer.appendChild(canvas)
		context = canvas.getContext("2d")
		context.imageSmoothingEnabled = false
		pixelRato = getPixelRatio(context)
		animate()

		canvas.addEventListener("click", onClick)
	})

	function animate() {
		context.clearRect(0, 0, canvas.width, canvas.height);
		draw(context)
		requestAnimationFrame(animate);
	}

	function getPixelRatio(context) {
        let dpr = window.devicePixelRatio || 1;
        let bsr = context.webkitBackingStorePixelRatio ||
            context.mozBackingStorePixelRatio ||
            context.msBackingStorePixelRatio ||
            context.oBackingStorePixelRatio ||
            context.backingStorePixelRatio || 1;
    
        return dpr / bsr;
    }
	function onResize() {
        pixelRato = getPixelRatio(context)
        let canvasBounds = canvas.getBoundingClientRect();
        canvas.width = canvasBounds.width * ratio;
        canvas.height = canvasBounds.height * ratio;
        context.scale(ratio, ratio);
    }

	var coin = {x: 128, y: 128}
	var coinTarget = {x: 64, y: 64}
	var movingId = 0

	function draw(ctx) {
		update()
		ctx.fillStyle = "gold"
		ctx.beginPath()
		ctx.arc(coin.x, coin.y, 8, 0, 2 * Math.PI)
		ctx.fill()
	}

	function update() {			
	}

	function powerEasing(a, b, x) {
		return (b+a-2)* Math.pow(x,3) + (-2*a-b+3)* Math.pow(x,2) + a*x
	}
	window.tweenCounter = 0
	window.activeTweens = []
	function setTween(initialObject, targetProperties, duration = 1000, easingFunction = (x) => x, onComplete = () => {}) {
		let tweenId = ++window.tweenCounter
		let copy = {}
		for(let key in targetProperties) {
			copy[key] = initialObject[key]
		}
		let begin = new Date().getTime()
		setTimeout(() => {
			if(!window.activeTweens.includes(tweenId)) {
				return
			}
			for(let key in targetProperties) {
				initialObject[key] = targetProperties[key]
			}
			onComplete()
			delete window.activeTweens[window.activeTweens.indexOf(tweenId)]
		}, duration)
		window.activeTweens.push(tweenId)
		var runTween = () => {
			if(!window.activeTweens.includes(tweenId)) {
				return
			}
			let delta = (new Date().getTime() - begin) / duration
			for(let key in targetProperties) {
				initialObject[key] = (targetProperties[key] - copy[key]) * easingFunction(delta) + copy[key]
			}
			requestAnimationFrame(runTween)
		}
		runTween()
		return tweenId
	}

	function clearTween(id) {
		delete window.activeTweens[window.activeTweens.indexOf(id)]
	}

	function onClick(event) {
		clearTween(movingId)
		coinTarget.x = event.offsetX
		coinTarget.y = event.offsetY
		movingId = setTween(coin, coinTarget, 600, (x) => {
				return powerEasing(4, 0, x)
			})
		}
</script>
</body>
</html>